# Your rules go in this file! Comment out previous versions or things you want to keep around with a '#' in front.
#

#Frame 91
#alert http  $HOME_NET any -> $EXTERNAL_NET 80 (msg:"EMV MALWARE DAT File Download";\
#   flow:to_server,established;\
#   http.method; content: "GET";nocase;\
#   http.uri; content:"|2e|dat"; nocase;\
#   http.user_agent; content:"Mozilla/4.0";nocase;\
#   sid:10000000;\
#   )


#Frame 495
#alert http  $HOME_NET any -> $EXTERNAL_NET 80 (msg:"EMV Information: Windows Update Download";\
#   flow:to_server;\
#   http.method; content: "GET";nocase;\
#   http.uri; content:"/msdownload/update/v3/static/trustedr"; nocase;\
#   http.user_agent; content:"Microsoft-CryptoAPI";nocase;\
#   sid:10000001;\
#   )


#frame 644
#fileext and content:"|2e|exe";nocase;\ might be redudant but could get around
#the use of special characters to obsfuscate the file extension.
#alert http  $EXTERNAL_NET 80 -> $HOME_NET any (msg:"EMV Malware Executable Download";\
#   flow:to_client, established;\
#   http.header;content:"expires|3a||20|Tue, 01 Jan 1970";nocase;\
#   fileext:"exe";\
#   content:"|2e|exe";nocase;\
#   content:"disposition: attachment"; nocase;\
#   content:"this program cannot be run in dos mode";nocase;\
#   sid:10000002;\
#   )

#frame 799
#https://www.w3schools.com/tags/ref_attributes.asp
# brackets hex code: < = |3c|; > = |3e|
# |3c|link|3e| = <link>
# |3c||2f|tag|3e| == </tag>
#Search for the lack of HTML tags
#alert http  $EXTERNAL_NET 80 -> $HOME_NET any (msg:"EMV Malware Obsfuscated PE File Download";\
#   flow:to_client, established;\
#   http.header; content:"Content-Type|3a||20|text/html|3b||20|charset|3d|UTF|2d|8";nocase;\
#   http.header_names; content:!"|3c|head|3e|";nocase;\
#   content:!"|3c|link|3e|";nocase;\
#   content:!"|3c||2f|link|3e|";nocase;\
#   content:!"|3c|script|3e|";nocase;\
#   content:!"|3c||2f|script|3e|";nocase;\
#   content:!"|3c||21|doctype|20|html|3e|";nocase;\
#   content:!"|3c||21|doctype|20||3e|";nocase;\
#   content:!"|3c|html|3e|";nocase;\
#   content:!"|3c|head|3e|";nocase;\
#   content:!"|3c||2f|head|3e|";nocase;\
#   content:!"|3c|body|3e|";nocase;\
#   content:!"|3c||2f|body|3e|";nocase;\
#   sid:10000003;\
#   )


#frame 2834

# 0x5c is the "\" character
# More specific rules for this alert could be:
# If using IP
# smb.share;content:"|5c||5c|10.5.24.24|5c|";endswith;nocase;\
# using the fqdn
# smb.share;content:"|5c||5c|pcapworkshop|2d|dc|2e|";endswith;nocase;\
# smb.share;content:"|5c||5c|pcapworkshop|2d|dc|2e|pcapworkshop|2e|net|5c|sysvol";startswith;nocase;\
# smb.share;content:"|5c||5c|pcapworkshop|2d|dc|2e|pcapworkshop|2e|net|5c|sysvol";nocase;\
#smb.share;content:"|5c|sysvol";endswith;nocase;\
## Note: The issue with the more specific rule is that the attacker could access the SMB share using the IP address
## of the machine and the rule will not flag. 

#alert smb $HOME_NET any -> any 445 (msg:"EMV SMB access to SYSVOL";\
#    flow:to_server,established;\
#    smb.share;content:"|5c|sysvol";endswith;nocase;\
#    sid:10000004;\
#    )

#smb.share;content:"|5c||5c|sysvol";nocase;\
#frame 6971
# Requests a .png file but what is actually downloaded is an PE/.exe
alert http $EXTERNAL_NET 80 -> $HOME_NET any (msg:"EMV Malware Obsfuscated PE File Request as PNG ";\
    flow:to_client,established;\
    content:"this program cannot be run in dos mode";nocase;\
    content:"|2e|dll";nocase;\
    http.header;content:"image|2f|png";nocase;\
    sid:1000005;\
    )

#Frame 9858
#alert tcp $HOME_NET any -> $EXTERNAL_NET 8082 (msg:"EMV Password Login";\
#   flow:to_server,established;\
#   content:"POST|20|";nocase;\
#   content:"disposition: form-data"; nocase;\
#   content:"name|3d|"; nocase;\
#   sid:1000006;\
#)

